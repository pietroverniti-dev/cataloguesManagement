{% extends "base.html" %}
{% block content %}
<h2>Elenco Prodotti</h2>

<form method="get" action="/products" style="margin-bottom: 20px; padding: 10px; background: #eee; border-radius: 5px;">
    <label for="cat-select">Filtra per categoria:</label>
    <select id="cat-select" name="category" onchange="this.form.submit()">
        <option value="Tutte" {% if current_category == 'Tutte' %}selected{% end %}>Tutte</option>
        <option value="Tech" {% if current_category == 'Tech' %}selected{% end %}>Tech</option>
        <option value="Abbigliamento" {% if current_category == 'Abbigliamento' %}selected{% end %}>Abbigliamento</option>
        <option value="Casa" {% if current_category == 'Casa' %}selected{% end %}>Casa</option>
    </select>
</form>

{% if products %}
<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Prezzo</th>
      <th>Categoria</th>
      <th>Stato</th>
      <th>Azioni</th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
    <tr>
      <td>{{ p["name"] }}</td>
      <td>â‚¬ {{ p["price"] }}</td>
      <td><span class="badge">{{ p["category"] }}</span></td>
      <td>
        {% if p["available"] %}
          <span style="color:green; font-weight:bold;">Disponibile</span>
        {% else %}
          <span style="color:red; font-weight:bold;">Non disponibile</span>
        {% end %}
      </td>
      <td>
        <form method="post" action="/products/toggle/{{ p['id'] }}" style="display:inline;">
          <button type="submit">Cambia Stato</button>
        </form>

        <form method="post" action="/products/delete/{{ p['id'] }}" style="display:inline;">
          <button type="submit" onclick="return confirm('Sicuro di voler eliminare?');" style="background-color: #ffcccc;">Elimina</button>
        </form>
      </td>
    </tr>
    {% end %}
  </tbody>
</table>
{% else %}
  <p>Nessun prodotto trovato.</p>
{% end %}

<style>
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
  th { background-color: #f2f2f2; }
  button { padding: 5px 10px; cursor: pointer; border: 1px solid #ccc; border-radius: 4px; }
  .badge { background: #e0e0e0; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
</style>

{% end %}